<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horizontal Chat Overlay</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Share+Tech+Mono&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://socialstream.ninja/libs/colours.js" type="text/javascript"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Share+Tech+Mono&family=Rajdhani:wght@400;500;600;700&display=swap');

:root {
    --cyber-pink: #ff0066;
    --cyber-cyan: #00ffff;
    --cyber-green: #00ff88;
    --cyber-yellow: #ffff00;
    --cyber-dark: #0d0d14;
}

body, html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    font-family: 'Share Tech Mono', monospace;
    background-color: transparent;
    overflow: hidden;
}

#chat-container {
    position: absolute;
    bottom: 30px;
    left: 0;
    width: 100%;
    height: auto;
    overflow: hidden;
    padding: 10px 0;
}

#message-list-wrapper {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 20px;
    padding-left: 100%;
    animation: scrollLeft 30s linear infinite;
    width: max-content;
}

#message-list-wrapper:hover {
    animation-play-state: paused;
}

@keyframes scrollLeft {
    0% {
        transform: translateX(0);
    }
    100% {
        transform: translateX(-100%);
    }
}

/* Glitch on appear */
@keyframes glitchIn {
    0% { 
        opacity: 0;
        transform: translateY(20px);
        filter: hue-rotate(90deg) brightness(2);
    }
    30% { 
        opacity: 1;
        transform: translateY(-5px);
        filter: hue-rotate(0deg) brightness(1);
    }
    100% { 
        opacity: 1;
        transform: translateY(0);
    }
}

/* ==================== */
/* MESSAGE ITEM         */
/* ==================== */
.message-outer {
    flex-shrink: 0;
    opacity: 0;
    animation: glitchIn 0.4s ease-out forwards;
}

.message {
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(13, 13, 20, 0.95);
    border-left: 3px solid var(--cyber-pink);
    padding: 8px 15px;
    white-space: nowrap;
}

/* Platform colors */
.message[data-type="youtube"] { border-left-color: #ff0000; }
.message[data-type="tiktok"] { border-left-color: var(--cyber-cyan); }
.message[data-type="twitch"] { border-left-color: #9147ff; }
.message[data-type="kick"] { border-left-color: var(--cyber-green); }
.message.streamer { border-left-color: var(--cyber-green); }
.message.moderator { border-left-color: #9147ff; }

.username-prefix {
    color: var(--cyber-pink);
    font-size: 0.9em;
    font-weight: bold;
}

.message.streamer .username-prefix { color: var(--cyber-green); }
.message.moderator .username-prefix { color: #9147ff; }
.message[data-type="youtube"] .username-prefix { color: #ff0000; }
.message[data-type="twitch"] .username-prefix { color: #9147ff; }
.message[data-type="tiktok"] .username-prefix { color: var(--cyber-cyan); }

.username {
    color: var(--cyber-cyan);
    font-size: 0.85em;
    font-weight: 700;
    font-family: 'Orbitron', sans-serif;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.message.streamer .username { color: var(--cyber-green); }
.message.moderator .username { color: #bf94ff; }

.badge-box {
    background: var(--cyber-pink);
    color: #000;
    font-size: 0.55em;
    font-weight: 800;
    padding: 2px 5px;
    font-family: 'Orbitron', sans-serif;
    text-transform: uppercase;
}

.badge-box.mod { background: #9147ff; color: #fff; }
.badge-box.member { background: var(--cyber-cyan); color: #000; }
.badge-box.owner { background: var(--cyber-green); color: #000; }

.message-divider {
    color: var(--cyber-pink);
    opacity: 0.5;
    font-size: 0.9em;
}

.message.streamer .message-divider { color: var(--cyber-green); }
.message.moderator .message-divider { color: #9147ff; }

.message-text {
    color: #d0d0d0;
    font-size: 0.9em;
    font-family: 'Rajdhani', sans-serif;
    font-weight: 500;
    max-width: 400px;
    overflow: hidden;
    text-overflow: ellipsis;
}

.message-text img {
    height: 24px;
    vertical-align: middle;
}

.source-icon {
    width: 16px;
    height: 16px;
    opacity: 0.7;
    margin-left: 5px;
}

/* ==================== */
/* SPECIAL: SUB/DONATE  */
/* ==================== */
.special-box {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(13, 13, 20, 0.98);
    border: 2px solid var(--cyber-pink);
    padding: 8px 15px;
    position: relative;
}

.special-box.membership {
    border-color: var(--cyber-green);
}

.pixel {
    position: absolute;
    width: 4px;
    height: 4px;
    background: var(--cyber-pink);
}

.pixel-1 { top: -5px; left: 20%; }
.pixel-2 { top: -5px; right: 20%; }
.pixel-3 { bottom: -5px; left: 30%; }
.pixel-4 { bottom: -5px; right: 30%; }

.special-box.membership .pixel {
    background: var(--cyber-green);
}

.special-label {
    color: var(--cyber-pink);
    font-size: 0.6em;
    font-family: 'Share Tech Mono', monospace;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 2px 6px;
    border: 1px solid var(--cyber-pink);
}

.special-box.membership .special-label {
    color: var(--cyber-green);
    border-color: var(--cyber-green);
}

.special-username {
    color: #ffffff;
    font-size: 0.9em;
    font-family: 'Orbitron', sans-serif;
    font-weight: 800;
    text-transform: uppercase;
}

.special-action {
    color: var(--cyber-cyan);
    font-size: 0.8em;
    font-family: 'Orbitron', sans-serif;
    font-weight: 600;
}

.special-amount {
    color: var(--cyber-yellow);
    font-size: 0.9em;
    font-family: 'Orbitron', sans-serif;
    font-weight: 800;
}

.special-message-text {
    color: #a0a0a0;
    font-size: 0.85em;
    font-family: 'Rajdhani', sans-serif;
    max-width: 300px;
    overflow: hidden;
    text-overflow: ellipsis;
    border-left: 1px solid var(--cyber-pink);
    padding-left: 10px;
    margin-left: 5px;
}

.special-box.membership .special-message-text {
    border-color: var(--cyber-green);
}
</style>
</head>
<body>
<div id="chat-container">
    <div id="message-list-wrapper"></div>
</div>
<script>
    // ============================================
    // KONFIGURASI
    // ============================================
    var SESSION_IDS = [
        "CNmktDA5ak",
        "3kLnN2suwn"
    ];
    
    var STREAMER_NAME = "ryubie";
    var MAX_MESSAGES = 15;
    
    // Scroll speed (seconds) - lebih kecil = lebih cepat
    var SCROLL_SPEED = 25;
    
    // ============================================
    var urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has("session")) SESSION_IDS.push(urlParams.get("session"));
    if (urlParams.has("streamer")) STREAMER_NAME = urlParams.get("streamer").toLowerCase();
    if (urlParams.has("limit")) MAX_MESSAGES = parseInt(urlParams.get("limit"));
    if (urlParams.has("speed")) SCROLL_SPEED = parseInt(urlParams.get("speed"));
    
    var password = "false";
    var featuredMode = false;

    const messageListWrapper = document.getElementById('message-list-wrapper');
    const processedMessages = new Set();
    
    // Set scroll speed
    messageListWrapper.style.animationDuration = SCROLL_SPEED + 's';

    function recalculateScroll() {
        const wrapper = messageListWrapper;
        const contentWidth = wrapper.scrollWidth;
        
        // Adjust animation duration based on content width
        const baseSpeed = SCROLL_SPEED;
        const adjustedSpeed = Math.max(baseSpeed, contentWidth / 50);
        wrapper.style.animationDuration = adjustedSpeed + 's';
    }
    
    function getBadgeInfo(data) {
        if (data.owner || data.isOwner) return { text: 'OWNER', class: 'owner' };
        if (data.mod || data.isMod || data.moderator) return { text: 'MOD', class: 'mod' };
        if (data.membership) return { text: 'MEMBER', class: 'member' };
        if (data.chatbadges) {
            for (let badge of data.chatbadges) {
                const str = typeof badge === 'string' ? badge : (badge.src || '');
                if (str.toLowerCase().includes('vip')) return { text: 'VIP', class: 'vip' };
            }
        }
        return null;
    }
    
    function addMessageToOverlay(data) {
        if (!data.chatname && !data.chatmessage && !data.hasDonation && !data.donation) return;
        
        const msgKey = data.mid || (data.chatname + data.chatmessage + (data.hasDonation || ''));
        if (processedMessages.has(msgKey)) return;
        processedMessages.add(msgKey);
        
        if (processedMessages.size > 200) {
            Array.from(processedMessages).slice(0, 100).forEach(k => processedMessages.delete(k));
        }
        
        let isStreamer = false, isModerator = false, isMembership = false, isDonation = false;
        
        if (STREAMER_NAME && data.chatname) {
            const n = data.chatname.toLowerCase();
            if (n === STREAMER_NAME || n.includes(STREAMER_NAME) || STREAMER_NAME.includes(n)) isStreamer = true;
        }
        if (data.owner || data.isOwner) isStreamer = true;
        if (data.membership) isMembership = true;
        if (data.hasDonation || data.donation) isDonation = true;
        if (data.mod || data.isMod || data.moderator) isModerator = true;
        if (data.chatbadges) {
            if (data.chatbadges.some(b => {
                const s = typeof b === 'string' ? b : (b.src || '');
                return s.toLowerCase().includes('moderator') || s.toLowerCase().includes('/mod');
            })) isModerator = true;
        }
        
        const messageId = 'msg-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        let messageOuter = document.createElement('div');
        messageOuter.classList.add('message-outer');
        messageOuter.id = messageId;
        
        if ((isDonation || isMembership) && !isStreamer) {
            // === SPECIAL STYLE ===
            const isMem = isMembership && !isDonation;
            const typeClass = isMem ? 'membership' : 'donation';
            const label = isMem ? 'SUB' : 'GIFT';
            const action = isDonation ? '' : (data.membership || '');
            const amount = isDonation ? (data.hasDonation || data.donation || '') : '';
            const msg = data.chatmessage || '';
            
            messageOuter.innerHTML = `
                <div class="special-box ${typeClass}">
                    <div class="pixel pixel-1"></div>
                    <div class="pixel pixel-2"></div>
                    <div class="pixel pixel-3"></div>
                    <div class="pixel pixel-4"></div>
                    <span class="special-label">${label}</span>
                    <span class="special-username">${data.chatname || 'ANON'}</span>
                    ${action ? `<span class="special-action">${action}</span>` : ''}
                    ${amount ? `<span class="special-amount">${amount}</span>` : ''}
                    ${msg ? `<span class="special-message-text">${msg}</span>` : ''}
                </div>
            `;
            
        } else {
            // === NORMAL CHAT ===
            const msgDiv = document.createElement('div');
            msgDiv.classList.add('message');
            if (data.type) msgDiv.setAttribute('data-type', data.type.toLowerCase());
            if (isStreamer) msgDiv.classList.add('streamer');
            else if (isModerator) msgDiv.classList.add('moderator');
            
            const badge = getBadgeInfo(data);
            const badgeHtml = badge ? `<span class="badge-box ${badge.class}">${badge.text}</span>` : '';
            
            const srcIcon = data.type ? `<img src="https://socialstream.ninja/sources/images/${data.type}.png" class="source-icon" alt="">` : '';
            
            // Clean message (remove images for horizontal)
            let cleanMsg = data.chatmessage || '';
            
            msgDiv.innerHTML = `
                <span class="username-prefix">+</span>
                <span class="username">${data.chatname || 'ANON'}</span>
                ${badgeHtml}
                <span class="message-divider">â€º</span>
                <span class="message-text">${cleanMsg}</span>
                ${srcIcon}
            `;
            
            messageOuter.appendChild(msgDiv);
        }

        messageListWrapper.appendChild(messageOuter);
        
        // Remove old messages
        const messages = messageListWrapper.querySelectorAll('.message-outer');
        if (messages.length > MAX_MESSAGES) {
            messages[0].remove();
        }
        
        recalculateScroll();
    }

    // === SETUP SESSIONS ===
    SESSION_IDS.forEach(roomID => {
        const iframe = document.createElement("iframe");
        iframe.src = featuredMode 
            ? `https://vdo.socialstream.ninja/?ln&password=${password}&salt=vdo.ninja&label=overlay&exclude=${roomID}&scene&novideo&noaudio&cleanoutput&room=${roomID}`
            : `https://vdo.socialstream.ninja/?ln&salt=vdo.ninja&password=${password}&push&label=dock&vd=0&ad=0&novideo&noaudio&autostart&cleanoutput&room=${roomID}`;
        iframe.style.cssText = "width:0;height:0;position:fixed;left:-100px;top:-100px;";
        document.body.appendChild(iframe);
        
        let conCon = 1;
        const serverURL = urlParams.has("localserver") ? "ws://127.0.0.1:3000" : "wss://io.socialstream.ninja";
        
        function setupSocket(){
            const ws = new WebSocket(serverURL);
            ws.onclose = () => setTimeout(() => { conCon++; setupSocket(); }, 100*conCon);
            ws.onopen = () => { conCon = 1; ws.send(JSON.stringify({"join":roomID, "out":3, "in":4})); };
            ws.onmessage = e => { try { addMessageToOverlay(JSON.parse(e.data)); } catch(err){} };
        }
        
        if (urlParams.has("server") || urlParams.has("server2")) setupSocket();
        console.log("Connected:", roomID);
    });
    
    window.addEventListener("message", e => {
        if (e.data.dataReceived?.overlayNinja) addMessageToOverlay(e.data.dataReceived.overlayNinja);
    });
</script>
</body>
</html>
